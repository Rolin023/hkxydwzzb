<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>党员信息管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.13.2/dist/av-min.js"></script>
    <style>
        :root {
            --primary-color: #c7000b;
            --primary-dark: #a30008;
            --primary-light: #e74c3c;
            --secondary-color: #f8f9fa;
            --accent-color: #d9534f;
            --admin-color: #c7000b;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e8ecef 100%);
            font-family: 'Microsoft YaHei', sans-serif;
            padding-bottom: 50px;
            min-height: 100vh;
        }
        
        .login-container, .form-container, .query-container, .management-container, .password-container, .register-container {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(199, 0, 11, 0.1);
            padding: 30px;
            margin-top: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(199, 0, 11, 0.1);
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
            border-radius: 0 0 15px 15px;
            position: relative;
            box-shadow: 0 4px 6px rgba(199, 0, 11, 0.2);
        }
        
        .admin-header {
            background: linear-gradient(135deg, var(--admin-color) 0%, #a30008 100%);
        }
        
        .header h1 {
            margin: 0;
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        .header h1 i {
            margin-right: 15px;
            font-size: 1.8rem;
        }
        
        .btn-primary {
            background: linear-gradient(to right, var(--primary-color), var(--primary-dark));
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(199, 0, 11, 0.2);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(199, 0, 11, 0.3);
            background: linear-gradient(to right, var(--primary-dark), var(--primary-color));
        }
        
        .btn-outline-primary {
            color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-outline-primary:hover {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-admin {
            background: linear-gradient(to right, var(--admin-color), #a30008);
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(199, 0, 11, 0.2);
        }
        
        .btn-admin:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(199, 0, 11, 0.3);
        }
        
        .btn-secondary {
            background-color: #6c757d;
            border-color: #6c757d;
        }
        
        .form-label {
            font-weight: 600;
            color: #495057;
        }
        
        .required:after {
            content: " *";
            color: var(--accent-color);
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(199, 0, 11, 0.25);
        }
        
        .card {
            margin-bottom: 20px;
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(199, 0, 11, 0.08);
            transition: transform 0.3s;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            font-weight: 600;
            padding: 15px 20px;
            border-bottom: none;
        }
        
        .admin-card-header {
            background: linear-gradient(135deg, var(--admin-color) 0%, #a30008 100%);
        }
        
        .logout-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            border-radius: 8px;
            padding: 8px 15px;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .system-info {
            text-align: center;
            margin-top: 30px;
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .error-message {
            color: var(--accent-color);
            font-size: 0.875rem;
            margin-top: 5px;
        }
        
        .success-message {
            color: #28a745;
            font-weight: 600;
            margin: 15px 0;
            text-align: center;
            padding: 10px;
            background-color: rgba(40, 167, 69, 0.1);
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }
        
        .nav-tabs {
            margin-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .nav-tabs .nav-link {
            border: none;
            border-radius: 8px 8px 0 0;
            padding: 12px 25px;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
        }
        
        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            background-color: white;
            border-bottom: 3px solid var(--primary-color);
        }
        
        .result-card {
            display: none;
        }
        
        .result-row {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .result-label {
            font-weight: 600;
            color: #555;
        }
        
        .pagination {
            justify-content: center;
            margin-top: 20px;
        }
        
        .stats-card {
            text-align: center;
            padding: 20px;
            border-radius: 12px;
            transition: all 0.3s;
            background: linear-gradient(135deg, rgba(199, 0, 11, 0.05) 0%, rgba(163, 0, 8, 0.05) 100%);
            border: 1px solid rgba(199, 0, 11, 0.1);
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(199, 0, 11, 0.1);
        }
        
        .stats-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .admin-stats-number {
            color: var(--admin-color);
        }
        
        .stats-label {
            font-size: 1rem;
            color: #6c757d;
            font-weight: 500;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .table-container {
            max-height: 500px;
            overflow-y: auto;
            margin-top: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .role-badge {
            position: absolute;
            top: 15px;
            left: 20px;
            font-size: 0.9rem;
            padding: 5px 12px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .admin-badge {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .password-strength {
            height: 5px;
            border-radius: 5px;
            margin-top: 5px;
            transition: all 0.3s;
        }
        
        .strength-weak {
            background-color: #dc3545;
            width: 33%;
        }
        
        .strength-medium {
            background-color: #ffc107;
            width: 66%;
        }
        
        .strength-strong {
            background-color: #28a745;
            width: 100%;
        }
        
        .college-accounts {
            margin-top: 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 20px;
        }
        
        .college-accounts h4 {
            margin-bottom: 15px;
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }
        
        .account-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .account-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .account-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: #495057;
        }
        
        .account-info {
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .table th {
            background-color: rgba(199, 0, 11, 0.05);
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
        }
        
        .modal-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
        }
        
        .password-requirements {
            font-size: 0.85rem;
            color: #6c757d;
            margin-top: 10px;
        }
        
        .password-requirements ul {
            padding-left: 20px;
            margin-bottom: 0;
        }
        
        .password-requirements li.valid {
            color: #28a745;
        }
        
        .password-requirements li.invalid {
            color: #dc3545;
        }
        
        .login-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        
        .login-option {
            width: 150px;
            height: 150px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }
        
        .login-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
            border-color: var(--primary-color);
        }
        
        .login-option.active {
            border-color: var(--primary-color);
            background: rgba(199, 0, 11, 0.05);
        }
        
        .login-option i {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .login-option span {
            font-size: 1.1rem;
            font-weight: 600;
            color: #495057;
        }
        
        .register-link {
            text-align: center;
            margin-top: 20px;
        }
        
        .account-limit-info {
            margin-top: 15px;
            padding: 10px;
            background-color: rgba(255, 193, 7, 0.1);
            border-radius: 8px;
            border-left: 4px solid #ffc107;
            font-size: 0.9rem;
            color: #856404;
        }
    </style>
</head>
<body>
    <!-- 登录界面 -->
    <div id="loginPage">
        <div class="header">
            <h1><i class="fas fa-users"></i> 党员信息管理系统</h1>
        </div>
        
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-8 col-lg-6">
                    <div class="login-container">
                        <h2 class="text-center mb-4">系统登录</h2>
                        
                        <form id="loginForm">
                            <div class="mb-3">
                                <label for="username" class="form-label">用户名</label>
                                <input type="text" class="form-control" id="username" placeholder="请输入用户名" required>
                            </div>
                            <div class="mb-3">
                                <label for="password" class="form-label">密码</label>
                                <input type="password" class="form-control" id="password" placeholder="请输入密码" required>
                            </div>
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary btn-lg">登录</button>
                                <button type="button" class="btn btn-outline-primary" id="showRegisterModal">注册新账号</button>
                            </div>
                            <div class="text-center mt-3">
                                <a href="#" id="changePasswordLink">修改密码</a>
                            </div>
                        </form>
                        
                        <div class="college-accounts">
                            <h4><i class="fas fa-info-circle"></i> 注册说明</h4>
                            <div class="account-limit-info">
                                <p><strong>账号注册限制：</strong></p>
                                <ul>
                                    <li>每个学院最多可注册 <strong>5</strong> 个账号</li>
                                    
                                    
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="system-info">
            <p>©  党员信息管理系统 |校党委组织部</p>
        </div>
    </div>
    
    <!-- 主界面 (默认隐藏) -->
    <div id="mainPage" style="display: none;">
        <div class="header" id="mainHeader">
            <h1><i class="fas fa-users"></i> 党员信息管理系统</h1>
            <div class="role-badge" id="roleBadge">普通用户</div>
            <button class="btn btn-light logout-btn" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i> 退出登录
            </button>
        </div>
        
        <div class="container">
            <ul class="nav nav-tabs" id="mainTabs">
                <li class="nav-item">
                    <a class="nav-link active" id="infoTab" data-bs-toggle="tab" href="#infoForm">信息录入</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="queryTab" data-bs-toggle="tab" href="#queryForm">信息查询</a>
                </li>
                <li class="nav-item" id="collegeDataTabItem">
                    <a class="nav-link" id="collegeDataTab" data-bs-toggle="tab" href="#collegeData">学院数据</a>
                </li>
                <li class="nav-item" id="manageTabItem" style="display: none;">
                    <a class="nav-link" id="manageTab" data-bs-toggle="tab" href="#manageData">数据管理</a>
                </li>
            </ul>
            
            <div class="tab-content">
                <!-- 信息录入界面 -->
                <div class="tab-pane fade show active" id="infoForm">
                    <div class="row">
                        <div class="col-md-8 offset-md-2">
                            <div class="form-container">
                                <h2 class="text-center mb-4">党员信息录入</h2>
                                <div id="submitSuccess" class="success-message" style="display: none;"></div>
                                <form id="partyMemberForm">
                                    <div class="card">
                                        <div class="card-header">基本信息</div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label for="name" class="form-label required">姓名</label>
                                                    <input type="text" class="form-control" id="name" required>
                                                    <div class="error-message" id="nameError"></div>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label for="idCard" class="form-label required">身份证号</label>
                                                    <input type="text" class="form-control" id="idCard" required maxlength="18">
                                                    <div class="error-message" id="idCardError"></div>
                                                </div>
                                            </div>
                                            
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label for="college" class="form-label required">学院</label>
                                                    <select class="form-select" id="college" required>
                                                        <option value="">请选择学院</option>
                                                        <option value="计算机科学与技术学院">计算机科学与技术学院</option>
                                                        <option value="文法学院">文法学院</option>
                                                        <option value="管理学院">管理学院</option>
                                                        <option value="外国语学院">外国语学院</option>
                                                        <option value="艺术设计学院">艺术设计学院</option>
                                                        <option value="经济与金融学院">经济与金融学院</option>
                                                        <option value="电子信息工程学院">电子信息工程学院</option>
                                                        <option value="音乐学院">音乐学院</option>
                                                        <option value="航空与智能制造学院">航空与智能制造学院</option>
                                                        <option value="传媒学院">传媒学院</option>
                                                    </select>
                                                    <div class="error-message" id="collegeError"></div>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label for="studentId" class="form-label required">学号</label>
                                                    <input type="text" class="form-control" id="studentId" required>
                                                    <div class="error-message" id="studentIdError"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="card">
                                        <div class="card-header">入党信息</div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label for="applyDate" class="form-label required">入党申请时间</label>
                                                    <input type="date" class="form-control" id="applyDate" required>
                                                    <div class="error-message" id="applyDateError"></div>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label for="activistDate" class="form-label required">成为积极分子时间</label>
                                                    <input type="date" class="form-control" id="activistDate" required>
                                                    <div class="error-message" id="activistDateError"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="d-grid mt-4">
                                        <button type="submit" class="btn btn-primary btn-lg">提交信息</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 信息查询界面 -->
                <div class="tab-pane fade" id="queryForm">
                    <div class="row">
                        <div class="col-md-8 offset-md-2">
                            <div class="query-container">
                                <h2 class="text-center mb-4">党员信息查询</h2>
                                <form id="queryForm">
                                    <div class="card">
                                        <div class="card-header">查询条件</div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label for="queryName" class="form-label">姓名</label>
                                                    <input type="text" class="form-control" id="queryName" placeholder="请输入姓名">
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label for="queryIdCard" class="form-label">身份证号</label>
                                                    <input type="text" class="form-control" id="queryIdCard" placeholder="请输入身份证号">
                                                </div>
                                            </div>
                                            <div class="d-grid">
                                                <button type="button" class="btn btn-primary" id="queryBtn">查询信息</button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                                
                                <div class="card result-card" id="queryResult">
                                    <div class="card-header">查询结果</div>
                                    <div class="card-body">
                                        <div class="row result-row">
                                            <div class="col-md-3 result-label">姓名：</div>
                                            <div class="col-md-9" id="resultName"></div>
                                        </div>
                                        <div class="row result-row">
                                            <div class="col-md-3 result-label">身份证号：</div>
                                            <div class="col-md-9" id="resultIdCard"></div>
                                        </div>
                                        <div class="row result-row">
                                            <div class="col-md-3 result-label">学院：</div>
                                            <div class="col-md-9" id="resultCollege"></div>
                                        </div>
                                        <div class="row result-row">
                                            <div class="col-md-3 result-label">学号：</div>
                                            <div class="col-md-9" id="resultStudentId"></div>
                                        </div>
                                        <div class="row result-row">
                                            <div class="col-md-3 result-label">入党申请时间：</div>
                                            <div class="col-md-9" id="resultApplyDate"></div>
                                        </div>
                                        <div class="row result-row">
                                            <div class="col-md-3 result-label">成为积极分子时间：</div>
                                            <div class="col-md-9" id="resultActivistDate"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 学院数据界面 -->
                <div class="tab-pane fade" id="collegeData">
                    <div class="query-container">
                        <h2 class="text-center mb-4">学院党员数据</h2>
                        
                        <div class="card">
                            <div class="card-header">本学院党员信息列表</div>
                            <div class="card-body">
                                <div class="table-container">
                                    <table class="table table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>姓名</th>
                                                <th>身份证号</th>
                                                <th>学号</th>
                                                <th>入党申请时间</th>
                                                <th>成为积极分子时间</th>
                                            </tr>
                                        </thead>
                                        <tbody id="collegeTableBody">
                                            <!-- 数据将通过JavaScript动态填充 -->
                                        </tbody>
                                    </table>
                                </div>
                                <div class="d-grid mt-3">
                                    <button type="button" class="btn btn-outline-primary" id="exportCollegeData">
                                        <i class="fas fa-download"></i> 导出本学院数据
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 数据管理界面 (仅管理员可见) -->
                <div class="tab-pane fade" id="manageData">
                    <div class="management-container">
                        <h2 class="text-center mb-4">党员数据管理</h2>
                        
                        <div class="row mb-4">
                            <div class="col-md-3">
                                <div class="stats-card">
                                    <div class="stats-number" id="totalCount">0</div>
                                    <div class="stats-label">党员总数</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stats-card">
                                    <div class="stats-number" id="todayCount">0</div>
                                    <div class="stats-label">今日新增</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stats-card">
                                    <div class="stats-number" id="collegeCount">0</div>
                                    <div class="stats-label">涉及学院</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stats-card">
                                    <div class="stats-number" id="monthCount">0</div>
                                    <div class="stats-label">本月新增</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header admin-card-header">数据操作</div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" id="searchInput" placeholder="搜索姓名、学号或身份证号">
                                    </div>
                                    <div class="col-md-6">
                                        <div class="action-buttons">
                                            <button class="btn btn-primary" id="searchBtn">
                                                <i class="fas fa-search"></i> 搜索
                                            </button>
                                            <button class="btn btn-outline-primary" id="exportBtn">
                                                <i class="fas fa-download"></i> 导出数据
                                            </button>
                                            <button class="btn btn-outline-primary" id="refreshBtn">
                                                <i class="fas fa-sync-alt"></i> 刷新
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="table-container">
                                    <table class="table table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>姓名</th>
                                                <th>身份证号</th>
                                                <th>学院</th>
                                                <th>学号</th>
                                                <th>入党申请时间</th>
                                                <th>成为积极分子时间</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody id="dataTableBody">
                                            <!-- 数据将通过JavaScript动态填充 -->
                                        </tbody>
                                    </table>
                                </div>
                                
                                <nav aria-label="数据分页">
                                    <ul class="pagination" id="pagination">
                                        <!-- 分页将通过JavaScript动态生成 -->
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 注册模态框 -->
    <div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="registerModalLabel">用户注册</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="registerSuccess" class="success-message" style="display: none;"></div>
                    <div id="registerError" class="error-message" style="display: none;"></div>
                    <form id="registerForm">
                        <div class="mb-3">
                            <label for="modalRegisterUsername" class="form-label required">用户名</label>
                            <input type="text" class="form-control" id="modalRegisterUsername" placeholder="请输入用户名" required>
                            <div class="error-message" id="modalRegisterUsernameError"></div>
                        </div>
                        <div class="mb-3">
                            <label for="modalRegisterPassword" class="form-label required">密码</label>
                            <input type="password" class="form-control" id="modalRegisterPassword" placeholder="请输入密码" required>
                            <div class="password-strength" id="modalRegisterPasswordStrength"></div>
                            <div class="password-requirements">
                                <p>密码强度要求：</p>
                                <ul>
                                    <li id="modalRegisterLengthReq" class="invalid">至少8个字符</li>
                                    <li id="modalRegisterUppercaseReq" class="invalid">包含大写字母</li>
                                    <li id="modalRegisterLowercaseReq" class="invalid">包含小写字母</li>
                                    <li id="modalRegisterNumberReq" class="invalid">包含数字</li>
                                    <li id="modalRegisterSpecialReq" class="invalid">包含特殊字符</li>
                                </ul>
                            </div>
                            <div class="error-message" id="modalRegisterPasswordError"></div>
                        </div>
                        <div class="mb-3">
                            <label for="modalRegisterConfirmPassword" class="form-label required">确认密码</label>
                            <input type="password" class="form-control" id="modalRegisterConfirmPassword" placeholder="请再次输入密码" required>
                            <div class="error-message" id="modalRegisterConfirmPasswordError"></div>
                        </div>
                        <div class="mb-3">
                            <label for="modalRegisterCollege" class="form-label required">所属部门</label>
                            <select class="form-select" id="modalRegisterCollege" required>
                                <option value="">请选择所属部门</option>
                                <option value="计算机科学与技术学院">计算机科学与技术学院</option>
                                <option value="文法学院">文法学院</option>
                                <option value="管理学院">管理学院</option>
                                <option value="外国语学院">外国语学院</option>
                                <option value="艺术设计学院">艺术设计学院</option>
                                <option value="经济与金融学院">经济与金融学院</option>
                                <option value="电子信息工程学院">电子信息工程学院</option>
                                <option value="音乐学院">音乐学院</option>
                                <option value="航空与智能制造学院">航空与智能制造学院</option>
                                <option value="传媒学院">传媒学院</option>
                                <option value="党委组织部">党委组织部</option>
                            </select>
                            <div class="error-message" id="modalRegisterCollegeError"></div>
                        </div>
                        <div class="mb-3">
                            <label for="modalRegisterRealName" class="form-label required">真实姓名</label>
                            <input type="text" class="form-control" id="modalRegisterRealName" placeholder="请输入真实姓名" required>
                            <div class="error-message" id="modalRegisterRealNameError"></div>
                        </div>
                        <div class="mb-3">
                            <label for="modalRegisterPhone" class="form-label">联系电话</label>
                            <input type="tel" class="form-control" id="modalRegisterPhone" placeholder="请输入联系电话">
                            <div class="error-message" id="modalRegisterPhoneError"></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="modalRegisterBtn">注册</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 修改密码模态框 -->
    <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="changePasswordModalLabel">修改密码</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="modalPasswordSuccess" class="success-message" style="display: none;"></div>
                    <div id="modalPasswordError" class="error-message" style="display: none;"></div>
                    <form id="modalPasswordForm">
                        <div class="mb-3">
                            <label for="modalUsername" class="form-label">用户名</label>
                            <input type="text" class="form-control" id="modalUsername" required>
                        </div>
                        <div class="mb-3">
                            <label for="modalCurrentPassword" class="form-label">当前密码</label>
                            <input type="password" class="form-control" id="modalCurrentPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="modalNewPassword" class="form-label">新密码</label>
                            <input type="password" class="form-control" id="modalNewPassword" required>
                            <div class="password-strength" id="modalPasswordStrength"></div>
                            <div class="password-requirements">
                                <p>密码强度要求：</p>
                                <ul>
                                    <li id="modalLengthReq" class="invalid">至少8个字符</li>
                                    <li id="modalUppercaseReq" class="invalid">包含大写字母</li>
                                    <li id="modalLowercaseReq" class="invalid">包含小写字母</li>
                                    <li id="modalNumberReq" class="invalid">包含数字</li>
                                    <li id="modalSpecialReq" class="invalid">包含特殊字符</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="modalConfirmPassword" class="form-label">确认新密码</label>
                            <input type="password" class="form-control" id="modalConfirmPassword" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="modalChangePasswordBtn">修改密码</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 查看详情模态框 -->
    <div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="detailModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="detailModalLabel">党员详细信息</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-2">
                        <div class="col-4 fw-bold">姓名：</div>
                        <div class="col-8" id="detailName"></div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-4 fw-bold">身份证号：</div>
                        <div class="col-8" id="detailIdCard"></div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-4 fw-bold">学院：</div>
                        <div class="col-8" id="detailCollege"></div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-4 fw-bold">学号：</div>
                        <div class="col-8" id="detailStudentId"></div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-4 fw-bold">入党申请时间：</div>
                        <div class="col-8" id="detailApplyDate"></div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-4 fw-bold">成为积极分子时间：</div>
                        <div class="col-8" id="detailActivistDate"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // LeanCloud 初始化
        const APP_ID = 'lxDHtmcgZSJI5ZIZPqnbUs1L-gzGzoHsz';
        const APP_KEY = 'ek6j2KjQxUINXcZgrpMnV80G';
        const SERVER_URL = 'https://lxdhtmcg.lc-cn-n1-shared.com';
        
        AV.init({
            appId: APP_ID,
            appKey: APP_KEY,
            serverURLs: SERVER_URL
        });
        
        // 用户账户信息（从LeanCloud加载）
        let userAccounts = {};
        
        // 账号限制配置
        const accountLimits = {
            '党委组织部': 6,  // 党委组织部最多6个账号
            'default': 5      // 其他学院最多5个账号
        };
        
        // 当前用户信息
        let currentUser = null;
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 注册按钮点击事件
            document.getElementById('showRegisterModal').addEventListener('click', function() {
                const modal = new bootstrap.Modal(document.getElementById('registerModal'));
                modal.show();
            });
            
            // 登录表单提交
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                login();
            });
            
            // 注册表单提交
            document.getElementById('modalRegisterBtn').addEventListener('click', function() {
                register();
            });
            
            // 修改密码链接点击事件
            document.getElementById('changePasswordLink').addEventListener('click', function(e) {
                e.preventDefault();
                const modal = new bootstrap.Modal(document.getElementById('changePasswordModal'));
                modal.show();
            });
            
            // 模态框修改密码按钮点击事件
            document.getElementById('modalChangePasswordBtn').addEventListener('click', function() {
                changePasswordModal();
            });
            
            // 退出登录按钮点击事件
            document.getElementById('logoutBtn').addEventListener('click', function() {
                logout();
            });
            
            // 信息录入表单提交
            document.getElementById('partyMemberForm').addEventListener('submit', function(e) {
                e.preventDefault();
                submitPartyMember();
            });
            
            // 查询按钮点击事件
            document.getElementById('queryBtn').addEventListener('click', function() {
                queryPartyMember();
            });
            
            // 学院数据导出按钮
            document.getElementById('exportCollegeData').addEventListener('click', function() {
                exportCollegeData();
            });
            
            // 管理员功能按钮事件
            document.getElementById('searchBtn').addEventListener('click', function() {
                loadPartyMembers();
            });
            
            document.getElementById('exportBtn').addEventListener('click', function() {
                exportData();
            });
            
            document.getElementById('refreshBtn').addEventListener('click', function() {
                loadPartyMembers();
            });
            
            // 密码强度检测
            document.getElementById('modalNewPassword').addEventListener('input', function() {
                checkPasswordStrength(this.value, 'modalPasswordStrength', 'modalLengthReq', 'modalUppercaseReq', 'modalLowercaseReq', 'modalNumberReq', 'modalSpecialReq');
            });
            
            document.getElementById('modalRegisterPassword').addEventListener('input', function() {
                checkPasswordStrength(this.value, 'modalRegisterPasswordStrength', 'modalRegisterLengthReq', 'modalRegisterUppercaseReq', 'modalRegisterLowercaseReq', 'modalRegisterNumberReq', 'modalRegisterSpecialReq');
            });
            
            // 搜索输入框回车事件
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    loadPartyMembers();
                }
            });
            
            // 页面加载时从LeanCloud加载用户数据
            loadUserAccountsFromCloud();
        });
        
        // 从LeanCloud加载用户账户数据
        function loadUserAccountsFromCloud() {
            const query = new AV.Query('SystemUser');
            return query.find().then(users => {
                userAccounts = {}; // 清空现有数据
                users.forEach(user => {
                    userAccounts[user.get('username')] = {
                        password: user.get('password'),
                        isAdmin: user.get('isAdmin') || false,
                        college: user.get('college'),
                        realName: user.get('realName'),
                        phone: user.get('phone')
                    };
                });
                console.log('用户数据加载完成:', userAccounts);
            }).catch(error => {
                console.error('加载用户数据失败:', error);
            });
        }
        
        // 检查部门账号数量限制
        function checkAccountLimit(college) {
            const limit = accountLimits[college] || accountLimits['default'];
            
            // 统计该部门已有账号数量
            let count = 0;
            for (const username in userAccounts) {
                if (userAccounts[username].college === college) {
                    count++;
                }
            }
            
            return count < limit;
        }
        
        // 登录功能
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                alert('请输入用户名和密码');
                return;
            }
            
            // 重新加载用户数据确保最新
            loadUserAccountsFromCloud().then(() => {
                // 验证用户凭据
                if (userAccounts[username] && userAccounts[username].password === password) {
                    currentUser = {
                        username: username,
                        isAdmin: userAccounts[username].isAdmin,
                        college: userAccounts[username].college
                    };
                    
                    // 显示主界面
                    document.getElementById('loginPage').style.display = 'none';
                    document.getElementById('mainPage').style.display = 'block';
                    
                    // 设置用户角色
                    document.getElementById('roleBadge').textContent = currentUser.isAdmin ? '管理员' : currentUser.college;
                    
                    // 设置标题栏颜色
                    if (currentUser.isAdmin) {
                        document.getElementById('mainHeader').classList.add('admin-header');
                    }
                    
                    // 显示/隐藏管理员选项卡
                    if (currentUser.isAdmin) {
                        document.getElementById('manageTabItem').style.display = 'block';
                        document.getElementById('collegeDataTabItem').style.display = 'none';
                        // 加载管理员数据
                        loadPartyMembers();
                    } else {
                        document.getElementById('manageTabItem').style.display = 'none';
                        document.getElementById('collegeDataTabItem').style.display = 'block';
                        // 设置学院选择框默认值
                        document.getElementById('college').value = currentUser.college;
                        // 加载学院数据
                        loadCollegeData();
                    }
                    
                    // 显示成功消息
                    showSuccessMessage('登录成功！', 'loginForm');
                } else {
                    alert('用户名或密码错误');
                }
            });
        }
        
        // 注册功能
        function register() {
            const username = document.getElementById('modalRegisterUsername').value;
            const password = document.getElementById('modalRegisterPassword').value;
            const confirmPassword = document.getElementById('modalRegisterConfirmPassword').value;
            const college = document.getElementById('modalRegisterCollege').value;
            const realName = document.getElementById('modalRegisterRealName').value;
            const phone = document.getElementById('modalRegisterPhone').value;
            
            // 清除之前的错误消息
            clearRegisterErrors();
            
            // 表单验证
            let isValid = true;
            
            if (!username) {
                document.getElementById('modalRegisterUsernameError').textContent = '请输入用户名';
                isValid = false;
            } else if (userAccounts[username]) {
                document.getElementById('modalRegisterUsernameError').textContent = '用户名已存在';
                isValid = false;
            }
            
            if (!password) {
                document.getElementById('modalRegisterPasswordError').textContent = '请输入密码';
                isValid = false;
            } else if (password.length < 8) {
                document.getElementById('modalRegisterPasswordError').textContent = '密码长度至少8位';
                isValid = false;
            } else if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]/.test(password)) {
                document.getElementById('modalRegisterPasswordError').textContent = '密码必须包含大小写字母、数字和特殊字符';
                isValid = false;
            }
            
            if (!confirmPassword) {
                document.getElementById('modalRegisterConfirmPasswordError').textContent = '请确认密码';
                isValid = false;
            } else if (password !== confirmPassword) {
                document.getElementById('modalRegisterConfirmPasswordError').textContent = '两次输入的密码不一致';
                isValid = false;
            }
            
            if (!college) {
                document.getElementById('modalRegisterCollegeError').textContent = '请选择所属部门';
                isValid = false;
            } else if (!checkAccountLimit(college)) {
                const limit = accountLimits[college] || accountLimits['default'];
                document.getElementById('modalRegisterCollegeError').textContent = `该部门账号数量已达上限（最多${limit}个）`;
                isValid = false;
            }
            
            if (!realName) {
                document.getElementById('modalRegisterRealNameError').textContent = '请输入真实姓名';
                isValid = false;
            }
            
            if (!isValid) {
                return;
            }
            
            // 创建系统用户对象
            const SystemUser = AV.Object.extend('SystemUser');
            const systemUser = new SystemUser();
            
            // 设置属性
            systemUser.set('username', username);
            systemUser.set('password', password);
            systemUser.set('college', college);
            systemUser.set('realName', realName);
            systemUser.set('phone', phone);
            
            // 设置管理员权限：只有党委组织部的用户可以成为管理员
            systemUser.set('isAdmin', college === '党委组织部');
            
            // 保存到LeanCloud
            systemUser.save().then(() => {
                // 更新本地用户账户
                userAccounts[username] = {
                    password: password,
                    isAdmin: college === '党委组织部',
                    college: college,
                    realName: realName,
                    phone: phone
                };
                
                // 显示成功消息
                showSuccessMessage('注册成功！请使用新账户登录。', 'registerSuccess');
                
                // 清空表单
                document.getElementById('modalRegisterUsername').value = '';
                document.getElementById('modalRegisterPassword').value = '';
                document.getElementById('modalRegisterConfirmPassword').value = '';
                document.getElementById('modalRegisterCollege').value = '';
                document.getElementById('modalRegisterRealName').value = '';
                document.getElementById('modalRegisterPhone').value = '';
                
                // 3秒后关闭模态框
                setTimeout(() => {
                    const modal = bootstrap.Modal.getInstance(document.getElementById('registerModal'));
                    modal.hide();
                }, 3000);
            }).catch(error => {
                console.error('注册失败:', error);
                alert('注册失败，请稍后重试');
            });
        }
        
        // 清除注册表单错误消息
        function clearRegisterErrors() {
            document.getElementById('modalRegisterUsernameError').textContent = '';
            document.getElementById('modalRegisterPasswordError').textContent = '';
            document.getElementById('modalRegisterConfirmPasswordError').textContent = '';
            document.getElementById('modalRegisterCollegeError').textContent = '';
            document.getElementById('modalRegisterRealNameError').textContent = '';
            document.getElementById('modalRegisterPhoneError').textContent = '';
        }
        
        // 加载学院数据
        function loadCollegeData() {
            if (!currentUser) return;
            
            const query = new AV.Query('PartyMember');
            query.equalTo('college', currentUser.college);
            query.descending('createdAt');
            
            query.find().then(partyMembers => {
                const tbody = document.getElementById('collegeTableBody');
                tbody.innerHTML = '';
                
                partyMembers.forEach((member, index) => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${member.get('name')}</td>
                        <td>${member.get('idCard')}</td>
                        <td>${member.get('studentId')}</td>
                        <td>${formatDate(member.get('applyDate'))}</td>
                        <td>${formatDate(member.get('activistDate'))}</td>
                    `;
                });
            }).catch(error => {
                console.error('加载学院数据失败:', error);
            });
        }
        
        // 导出学院数据
        function exportCollegeData() {
            if (!currentUser) return;
            
            const query = new AV.Query('PartyMember');
            query.equalTo('college', currentUser.college);
            query.limit(1000);
            
            query.find().then(partyMembers => {
                let csvContent = "姓名,身份证号,学院,学号,入党申请时间,成为积极分子时间\n";
                
                partyMembers.forEach(member => {
                    csvContent += `"${member.get('name')}","${member.get('idCard')}","${member.get('college')}","${member.get('studentId')}","${formatDate(member.get('applyDate'))}","${formatDate(member.get('activistDate'))}"\n`;
                });
                
                const encodedUri = encodeURI('data:text/csv;charset=utf-8,' + csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", `${currentUser.college}党员信息.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }).catch(error => {
                console.error('导出学院数据失败:', error);
                alert('导出失败，请稍后重试');
            });
        }
        
        // 退出登录
        function logout() {
            currentUser = null;
            document.getElementById('mainPage').style.display = 'none';
            document.getElementById('loginPage').style.display = 'block';
            document.getElementById('loginForm').reset();
        }
        
        // 提交党员信息
        function submitPartyMember() {
            const name = document.getElementById('name').value;
            const idCard = document.getElementById('idCard').value;
            const college = document.getElementById('college').value;
            const studentId = document.getElementById('studentId').value;
            const applyDate = document.getElementById('applyDate').value;
            const activistDate = document.getElementById('activistDate').value;
            
            // 简单验证
            if (!name || !idCard || !college || !studentId || !applyDate || !activistDate) {
                alert('请填写所有必填字段');
                return;
            }
            
            // 如果不是管理员，只能添加本学院数据
            if (!currentUser.isAdmin && college !== currentUser.college) {
                alert('您只能添加本学院的数据');
                return;
            }
            
            // 身份证号验证
            if (!validateIdCard(idCard)) {
                alert('请输入有效的身份证号码');
                return;
            }
            
            // 创建LeanCloud对象
            const PartyMember = AV.Object.extend('PartyMember');
            const partyMember = new PartyMember();
            
            // 设置属性
            partyMember.set('name', name);
            partyMember.set('idCard', idCard);
            partyMember.set('college', college);
            partyMember.set('studentId', studentId);
            partyMember.set('applyDate', new Date(applyDate));
            partyMember.set('activistDate', new Date(activistDate));
            partyMember.set('createdBy', currentUser.username);
            
            // 保存到LeanCloud
            partyMember.save().then(() => {
                // 显示成功消息
                showSuccessMessage('党员信息提交成功！', 'submitSuccess');
                
                // 清空表单
                document.getElementById('partyMemberForm').reset();
                
                // 如果是管理员，刷新数据
                if (currentUser.isAdmin) {
                    loadPartyMembers();
                } else {
                    // 如果是学院用户，刷新学院数据
                    loadCollegeData();
                }
            }).catch(error => {
                console.error('保存失败:', error);
                alert('提交失败，请稍后重试');
            });
        }
        
        // 查询党员信息
        function queryPartyMember() {
            const name = document.getElementById('queryName').value;
            const idCard = document.getElementById('queryIdCard').value;
            
            if (!name && !idCard) {
                alert('请输入姓名或身份证号进行查询');
                return;
            }
            
            // 构建查询
            const query = new AV.Query('PartyMember');
            
            if (name) {
                query.equalTo('name', name);
            }
            
            if (idCard) {
                query.equalTo('idCard', idCard);
            }
            
            // 如果不是管理员，只能查询本学院数据
            if (!currentUser.isAdmin) {
                query.equalTo('college', currentUser.college);
            }
            
            // 执行查询
            query.first().then(partyMember => {
                if (partyMember) {
                    // 显示查询结果
                    document.getElementById('resultName').textContent = partyMember.get('name');
                    document.getElementById('resultIdCard').textContent = partyMember.get('idCard');
                    document.getElementById('resultCollege').textContent = partyMember.get('college');
                    document.getElementById('resultStudentId').textContent = partyMember.get('studentId');
                    document.getElementById('resultApplyDate').textContent = formatDate(partyMember.get('applyDate'));
                    document.getElementById('resultActivistDate').textContent = formatDate(partyMember.get('activistDate'));
                    
                    // 显示结果卡片
                    document.getElementById('queryResult').style.display = 'block';
                } else {
                    alert('未找到匹配的党员信息');
                    document.getElementById('queryResult').style.display = 'none';
                }
            }).catch(error => {
                console.error('查询失败:', error);
                alert('查询失败，请稍后重试');
            });
        }
        
        // 加载党员数据（管理员功能）
        function loadPartyMembers(page = 1, pageSize = 10) {
            const searchText = document.getElementById('searchInput').value;
            
            // 构建查询
            const query = new AV.Query('PartyMember');
            
            // 添加搜索条件
            if (searchText) {
                const nameQuery = new AV.Query('PartyMember');
                nameQuery.contains('name', searchText);
                
                const idCardQuery = new AV.Query('PartyMember');
                idCardQuery.contains('idCard', searchText);
                
                const studentIdQuery = new AV.Query('PartyMember');
                studentIdQuery.contains('studentId', searchText);
                
                query._orQuery = [nameQuery, idCardQuery, studentIdQuery];
            }
            
            // 排序
            query.descending('createdAt');
            
            // 分页
            query.limit(pageSize);
            query.skip((page - 1) * pageSize);
            
            // 执行查询
            query.find().then(partyMembers => {
                // 清空表格
                const tbody = document.getElementById('dataTableBody');
                tbody.innerHTML = '';
                
                // 填充数据
                partyMembers.forEach((member, index) => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${(page - 1) * pageSize + index + 1}</td>
                        <td>${member.get('name')}</td>
                        <td>${member.get('idCard')}</td>
                        <td>${member.get('college')}</td>
                        <td>${member.get('studentId')}</td>
                        <td>${formatDate(member.get('applyDate'))}</td>
                        <td>${formatDate(member.get('activistDate'))}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary view-btn" data-id="${member.id}">
                                <i class="fas fa-eye"></i> 查看
                            </button>
                            <button class="btn btn-sm btn-outline-danger delete-btn" data-id="${member.id}" ${!currentUser.isAdmin ? 'disabled' : ''}>
                                <i class="fas fa-trash"></i> 删除
                            </button>
                        </td>
                    `;
                });
                
                // 添加查看和删除按钮事件
                document.querySelectorAll('.view-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        viewMemberDetails(this.getAttribute('data-id'));
                    });
                });
                
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    if (!btn.disabled) {
                        btn.addEventListener('click', function() {
                            deleteMember(this.getAttribute('data-id'));
                        });
                    }
                });
                
                // 获取总数用于分页
                return query.count();
            }).then(count => {
                // 生成分页
                generatePagination(page, Math.ceil(count / pageSize));
                
                // 更新统计信息
                updateStats(count);
            }).catch(error => {
                console.error('加载数据失败:', error);
                alert('加载数据失败，请稍后重试');
            });
        }
        
        // 查看党员详细信息
        function viewMemberDetails(id) {
            const query = new AV.Query('PartyMember');
            query.get(id).then(member => {
                document.getElementById('detailName').textContent = member.get('name');
                document.getElementById('detailIdCard').textContent = member.get('idCard');
                document.getElementById('detailCollege').textContent = member.get('college');
                document.getElementById('detailStudentId').textContent = member.get('studentId');
                document.getElementById('detailApplyDate').textContent = formatDate(member.get('applyDate'));
                document.getElementById('detailActivistDate').textContent = formatDate(member.get('activistDate'));
                
                const modal = new bootstrap.Modal(document.getElementById('detailModal'));
                modal.show();
            }).catch(error => {
                console.error('获取详细信息失败:', error);
                alert('获取详细信息失败');
            });
        }
        
        // 删除党员信息
        function deleteMember(id) {
            if (!confirm('确定要删除这条党员信息吗？此操作不可恢复。')) {
                return;
            }
            
            const member = AV.Object.createWithoutData('PartyMember', id);
            member.destroy().then(() => {
                alert('删除成功');
                loadPartyMembers();
            }).catch(error => {
                console.error('删除失败:', error);
                alert('删除失败，请稍后重试');
            });
        }
        
        // 生成分页
        function generatePagination(currentPage, totalPages) {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';
            
            // 上一页
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `<a class="page-link" href="#">上一页</a>`;
            prevLi.addEventListener('click', function(e) {
                e.preventDefault();
                if (currentPage > 1) {
                    loadPartyMembers(currentPage - 1);
                }
            });
            pagination.appendChild(prevLi);
            
            // 页码
            for (let i = 1; i <= totalPages; i++) {
                const pageLi = document.createElement('li');
                pageLi.className = `page-item ${i === currentPage ? 'active' : ''}`;
                pageLi.innerHTML = `<a class="page-link" href="#">${i}</a>`;
                pageLi.addEventListener('click', function(e) {
                    e.preventDefault();
                    loadPartyMembers(i);
                });
                pagination.appendChild(pageLi);
            }
            
            // 下一页
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
            nextLi.innerHTML = `<a class="page-link" href="#">下一页</a>`;
            nextLi.addEventListener('click', function(e) {
                e.preventDefault();
                if (currentPage < totalPages) {
                    loadPartyMembers(currentPage + 1);
                }
            });
            pagination.appendChild(nextLi);
        }
        
        // 更新统计信息
        function updateStats(totalCount) {
            document.getElementById('totalCount').textContent = totalCount;
            
            // 简单模拟其他统计数据（实际应用中应从服务器获取）
            document.getElementById('todayCount').textContent = Math.floor(totalCount * 0.05);
            document.getElementById('collegeCount').textContent = 10; // 10个学院
            document.getElementById('monthCount').textContent = Math.floor(totalCount * 0.1);
        }
        
        // 导出数据
        function exportData() {
            // 构建查询获取所有数据
            const query = new AV.Query('PartyMember');
            query.limit(1000); // 限制导出数量
            
            query.find().then(partyMembers => {
                // 构建CSV内容
                let csvContent = "姓名,身份证号,学院,学号,入党申请时间,成为积极分子时间\n";
                
                partyMembers.forEach(member => {
                    csvContent += `"${member.get('name')}","${member.get('idCard')}","${member.get('college')}","${member.get('studentId')}","${formatDate(member.get('applyDate'))}","${formatDate(member.get('activistDate'))}"\n`;
                });
                
                // 创建下载链接
                const encodedUri = encodeURI('data:text/csv;charset=utf-8,' + csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "党员信息.csv");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }).catch(error => {
                console.error('导出失败:', error);
                alert('导出失败，请稍后重试');
            });
        }
        
        // 修改密码（登录界面模态框）
        function changePasswordModal() {
            const username = document.getElementById('modalUsername').value;
            const currentPassword = document.getElementById('modalCurrentPassword').value;
            const newPassword = document.getElementById('modalNewPassword').value;
            const confirmPassword = document.getElementById('modalConfirmPassword').value;
            
            if (!username || !currentPassword || !newPassword || !confirmPassword) {
                showErrorMessage('请填写所有字段', 'modalPasswordError');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showErrorMessage('新密码和确认密码不匹配', 'modalPasswordError');
                return;
            }
            
            // 验证用户存在性和当前密码
            if (!userAccounts[username]) {
                showErrorMessage('用户名不存在', 'modalPasswordError');
                return;
            }
            
            if (userAccounts[username].password !== currentPassword) {
                showErrorMessage('当前密码错误', 'modalPasswordError');
                return;
            }
            
            // 更新密码
            userAccounts[username].password = newPassword;
            
            // 显示成功消息
            showSuccessMessage('密码修改成功！', 'modalPasswordSuccess');
            document.getElementById('modalPasswordForm').reset();
            
            // 3秒后关闭模态框
            setTimeout(() => {
                const modal = bootstrap.Modal.getInstance(document.getElementById('changePasswordModal'));
                modal.hide();
            }, 3000);
        }
        
        // 检查密码强度
        function checkPasswordStrength(password, strengthBarId, lengthId, upperId, lowerId, numberId, specialId) {
            const strengthBar = document.getElementById(strengthBarId);
            const lengthReq = document.getElementById(lengthId);
            const uppercaseReq = document.getElementById(upperId);
            const lowercaseReq = document.getElementById(lowerId);
            const numberReq = document.getElementById(numberId);
            const specialReq = document.getElementById(specialId);
            
            // 重置样式
            strengthBar.className = 'password-strength';
            lengthReq.className = 'invalid';
            uppercaseReq.className = 'invalid';
            lowercaseReq.className = 'invalid';
            numberReq.className = 'invalid';
            specialReq.className = 'invalid';
            
            let strength = 0;
            
            // 长度检查
            if (password.length >= 8) {
                strength++;
                lengthReq.className = 'valid';
            }
            
            // 大写字母检查
            if (/[A-Z]/.test(password)) {
                strength++;
                uppercaseReq.className = 'valid';
            }
            
            // 小写字母检查
            if (/[a-z]/.test(password)) {
                strength++;
                lowercaseReq.className = 'valid';
            }
            
            // 数字检查
            if (/[0-9]/.test(password)) {
                strength++;
                numberReq.className = 'valid';
            }
            
            // 特殊字符检查
            if (/[^A-Za-z0-9]/.test(password)) {
                strength++;
                specialReq.className = 'valid';
            }
            
            // 设置强度条样式
            if (strength > 0) {
                if (strength <= 2) {
                    strengthBar.className = 'password-strength strength-weak';
                } else if (strength <= 4) {
                    strengthBar.className = 'password-strength strength-medium';
                } else {
                    strengthBar.className = 'password-strength strength-strong';
                }
            }
        }
        
        // 显示成功消息
        function showSuccessMessage(message, elementId) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }
        
        // 显示错误消息
        function showErrorMessage(message, elementId) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }
        
        // 格式化日期
        function formatDate(date) {
            if (!date) return '';
            const d = new Date(date);
            return `${d.getFullYear()}-${(d.getMonth()+1).toString().padStart(2, '0')}-${d.getDate().toString().padStart(2, '0')}`;
        }
        
        // 身份证号验证
        function validateIdCard(idCard) {
            // 简单验证，实际应用中应使用更严格的验证
            return /^\d{17}[\dXx]$/.test(idCard);
        }
    </script>
</body>
</html>
